machine:
  python:
    version: 2.7.12
  environment:
    PYTHONPATH: ${PYTHONPATH}:${HOME}/sdk:${HOME}/${CIRCLE_PROJECT_REPONAME}/libs
    GCLOUD_PROJECT: "voteme-sir"

dependencies:
  pre:
    - bash ./appengine/setup_gcloud.sh
  override:
    - bash install_requirements.sh

deployment:
  production:
    pre:
      - gcloud app deploy app.yaml --version=1 --project=voteme-sir --verbosity=info
      - python e2e_ping.py

test:
  override:
    - nosetests -w ${HOME}/${CIRCLE_PROJECT_REPONAME}/tests -v
  post:
    - git reset --hard
    - git clean -d -x -f
